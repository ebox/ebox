<chapter id="ch-network">

	<title>Network Configuration</title>

	<section id='sect-ebox-interfaces'>
		<!-- Network->Interfaces -->
		<title>Network interfaces</title>

		<para>You can enter into network interfaces
		configuration at 
			<menuchoice>
				<guimenu>Network</guimenu>
				<guimenuitem>Interfaces</guimenuitem>
			</menuchoice>
		at the left menu.
		</para>

		<para>For each network interface we can choose a new name and its
		configuration. Available configurations are:
		</para>

		<variablelist>
			<varlistentry>
				<term>Static</term>
				<listitem>
					<para>It will assign permanently an IP address
					to the network interface. Once you have
					chosen the configuration, you can set if
					this network interface is
					external<footnote><para>On eBox, an interface is
					defined as external when its connection is directed
					to Internet. For instance, its IP address can be 
					an static public one. However, internal interface 
					is those where clients from your internal network
					are connected.</para></footnote>,
					its IP address and its network mask.</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term>DHCP</term>
				<listitem>
					<para>When you select this option for
					configuration, the network interface will be
					configured dynamically if a DHCP Server exists
					on the network. The only configuration
					parameter is the ability to be an external
					interface.</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term>Trunk 802.1Q</term>
				<listitem>
					<para>
					  When this method is selected, the interface
					  applies a mechanism which allows multiple bridged
					  networks to transparently share the same physical
					  network link without leakage of information
					  between networks, i.e. doing trunking.
					</para>
				</listitem>
			</varlistentry>
			<varlistentry>
				<term>Not configured</term>
				<listitem>
					<para>Network interface won't be configured.</para>
				</listitem>
			</varlistentry>
		</variablelist>

		<section>
			<title>Virtual interfaces</title>
			<para>
			A virtual interface is the one which is
			attached to a real one, and it is used to
			listen or serve another IP address apart from
			the real one, that is, the real interface can
			assist two or more networks just creating as
			many virtual interfaces as needed.
			</para>
			<para>It's possible to create new virtual interfaces bound to
			any interface configured as static.</para>
			<para>Once you have configured static interface, a form will
			be shown to add virtual interfaces, where you can assign their
			name, IP address and network mask.
			</para>
		</section>

	</section>

	<section id='sect-ebox-dns'>
		<!-- Network->DNS -->
		<title>DNS Servers</title>

		<para>You can set IP addresses for the DNS Server that you want to use
		to solve host names. You have to remember that, if your network
		interfaces are configured with DHCP, your network settings could be
		overwritten.</para>
	</section>

	<section id='sect-ebox-diagnostics'>
		<!-- Network->Diagnostics -->
		<title>Diagnostic tools</title>

		<para>You can use this tools to check if your network settings are
		correct.</para>

		<para>
		Selecting
			<menuchoice>
				<guimenu>Network</guimenu>
				<guimenuitem>Diagnostics</guimenuitem>
			</menuchoice>
		you could make a ping to a reachable host through your network
		interfaces, or you can resolve a domain name.</para>

		<para>The output of this operations will be shown on this page,
		corresponding with the standard output of the GNU/Linux commands
		<command>ping</command> and <command>dig</command>.</para>
	</section>

	<section id='sect-gateways'>
	  <!-- Network->Gateways -->
	  <title>Gateways</title>
	  
	  <para>
	    Through this section you can set the gateways where your network traffic is
	    directed. It is very useful in order to split or do balance your Internet traffic.
	  </para>

	  <para>
	    Choosing 
	    <menuchoice>
	      <guimenu>Network</guimenu>
	      <guimenuitem>Gateways</guimenuitem>
	    </menuchoice>
	    you could add as many gateways as you want. The following attributes
	    are required when adding a gateway:
	  </para>
	  <variablelist>
	    <varlistentry>
	      <term>Name</term>
	      <listitem>
		<para>
		  It is the logical name associated to the gateway in eBox which is used in
		  other eBox modules. It should be unique.
		</para>
	      </listitem>
	    </varlistentry>
	    <varlistentry>
	      <term>IP Address</term>
	      <listitem>
		<para>
		  The static gateway IP address. Its value has to be unique as well.
		</para>
	      </listitem>
	    </varlistentry>
	    <varlistentry>
	      <term>Interface</term>
	      <listitem>
		<para>
		  The interface from where the gateway is reachable. That is, it is the interface
		  where packets can be routed to get to the gateway.
		</para>
	      </listitem>
	    </varlistentry>
	    <varlistentry>
	      <term>Upload</term>
	      <listitem>
		<para>
		  The maximum upload rate (in <emphasis>Kilobits per second</emphasis>) you can
		  have towards the connection from eBox to the gateway. It will
		  surely depend on the sort of connection provided by your ISP.
		</para>
	      </listitem>
	    </varlistentry>
	    <varlistentry>
	      <term>Download</term>
	      <listitem>
		<para>
		  The maximum download rate (in <emphasis>Kilobits per second</emphasis>) you can
		  obtain towards the connection from the gateway to eBox.
		</para>
	      </listitem>
	    </varlistentry>
	    <varlistentry>
	      <term>Weight</term>
	      <listitem>
		<para>
		  It is the weight associated to this gateway. It is used by 
		  <link linkend="subsect-balance-traffic">balance traffic section</link> to apply
		  special rules applied to multiple gateways.
		</para>
	      </listitem>
	    </varlistentry>
	    <varlistentry>
	      <term>Default</term>
	      <listitem>
		<para>
		  It is set to determine whether the gateway is the default one or not.
		  This implies that any packet which does not have a explicit
		  gateway to be routed through will come out through the default
		  one. Note that <emphasis>just one</emphasis> gateway can be the
		  default one at the same time.
		</para>
	      </listitem>
	    </varlistentry>
	  </variablelist>
	  
	  <warning>
	    <para>
	      Each gateway should be reachable from at least one interface. eBox checks so
	      for each interface whose configuration is static. If the interface is configured
	      via DHCP, this inspection will be skipped since it is impossible to determine.
	    </para>
	  </warning>

	  <para>
	    The correct values for upload and download rate are critical to ensure the correct
	    functionality from <link linkend="ch-trafficshaping">traffic shaping module</link>.
	  </para>

	  <para>
	    Once you have added a gateway, it will appear at the <guilabel>Gateway list</guilabel>
	    . Then, you can delete it or edit the values set previously through the icons which
	    appear on the right side of the list.
	  </para>

	</section>

	<section id="sect-balance-traffic">
	  <title>Balance traffic and multigateway rules</title>

	  <section id="sect-requirements">
	    <title>Requirements</title>
	    <para>
	      In order to use these two features, at least two
	      gateways configured are required. Check
	      out <link linkend="sect-gateways">this section</link> to
	      know how to create them.
	    </para>
	  </section>

	  <section id="subsect-balance-traffic">
	    <title>Balance traffic</title>
	    <para>
	      You can enable <emphasis>traffic balancing</emphasis> via
	      <menuchoice>
		<guimenu>Network</guimenu>
		<guimenuitem>Balance traffic</guimenuitem>
	      </menuchoice>
	      in order to share your traffic through different routes. The traffic distribution
	      relies on a weighted sum from the gateway weights which are set on gateway attributes 
	      (See <link linkend="sect-gateways">Gateways section</link> to know how configured them).
	    </para>

	    <para>
	      A typical configuration could be as follows: you have
	      two gateways configurated where one has the double rate
	      capacity (A) than the other one (B). Thus you may want
	      to balance traffic in 2:1 proportion, that is, gateway A
	      will deliver the double traffic than B. To achieve so,
	      you should set the weight parameter to A to 2 and
	      gateway B will have weight set to 1.
	    </para>
	  </section>
	  
	  <section id="sect-multigateway-rules">
	    <title>Multigateway rules</title>
	    <para>
	      It may be needed to route explicitly traffic by a
	      certain gateway, to do so, you should use the
	      multigateway rules which mark the packets to be
	      delivered through the gateway selected.
	    </para>

	    <para>
	      The packets are matched depending on the rules given to
	      be directed to the asked gateway. You can select the
	      traffic according to the following factors:
	    </para>
	    <variablelist>
	      <varlistentry>
		<term>Protocol</term>
		<listitem>
		  <para>
		    It could be TCP, UDP or any. 
		  </para>
		</listitem>
	      </varlistentry>
	      <varlistentry>
		<term>Interface</term>
		<listitem>
		  <para>
		    The source interface where traffic comes from. The
		    list only includes internal interfaces.
		  </para>
		</listitem>
	      </varlistentry>
	      <varlistentry>
		<term>Source</term>
		<listitem>
		  <para>
		    You can select a source IP address or an eBox
		    network object. (See <link
		    linkend="sect-objects-desc">this chapter</link>
		    for details)
		  </para>
		</listitem>
	      </varlistentry>
	      <varlistentry>
		<term>Source port</term>
		<listitem>
		  <para>
		    You can choose a source port. You must select a
		    protocol different from any to be able to direct
		    traffic depending on the source port.
		  </para>
		</listitem>
	      </varlistentry>
	      <varlistentry>
		<term>Destination</term>
		<listitem>
		  <para>
		    You can select a destination IP address or an eBox
		    network object.
		  </para>
		</listitem>
	      </varlistentry>
	      <varlistentry>
		<term>Destination port</term>
		<listitem>
		  <para>
		    You can choose a destination port. The same policy
		    from source port is applied here.
		  </para>
		</listitem>
	      </varlistentry>
	    </variablelist>
	    <para>
	      After editing at least one of the factors you can select
	      a previously defined gateway to direct traffic which
	      matches with the defined attributes.
	    </para>
	    <para>
	      Once the rule has been added to the multigateway rule
	      list, you may edit or delete a previous defined rule
	      through its icons depicted on its right side.
	    </para>
	  </section>
	</section>

</chapter>
