#!/bin/bash

USER=$PAM_USER
SERVER=`grep ^host /etc/ldap.conf | cut -d' ' -f2`

USERHOME=/home/samba/users/$USER

# Most of this is for debug purposes only

env > $USERHOME/ENV_OUTPUT

PROFILE=$USERHOME/.profile

if ! grep -v ^# $PROFILE | grep -q ID_OUTPUT
then
    echo "id > $USERHOME/ID_OUTPUT" >> $PROFILE
fi

# Pidgin configuration
sed -i "s/USERNAME/$USER/g" $USERHOME/pidgin/accounts.xml
sed -i "s/EBOXDOMAIN/ebox/g" $USERHOME/pidgin/accounts.xml
sed -i "s/USERNAME/$USER/g" $USERHOME/pidgin/blist.xml
sed -i "s/EBOXDOMAIN/ebox/g" $USERHOME/pidgin/blist.xml
mv $USERHOME/pidgin $USERHOME/.purple

# Ekiga configuration
gconftool --type=list --set /apps/ekiga/protocols/accounts_list --list-type=string "[0|1|a8f3cffc-4427-de11-964c-00215d2248ac|$USER|SIP|$SERVER|$SERVER|$USER|$USER@ebox||3600|0]"

touch $USERHOME/SETUP_SUCCESSFUL
