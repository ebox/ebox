<suite>
    <name>eBox users Test Suite</name>
    <desc>Contains tests for user addition.
    </desc>

    <scenario>users.xml</scenario>

    <test type="selenium">
        <name>SetMaster</name>
        <desc>
        Configure eBox as LDAP master and set the password.
        </desc>

        <host var="master-slave" eq="1">ebox-master</host>
        <host var="master-slave" eq="0">ebox-test</host>

        <dir>set-master</dir>
        <var name="PASSWORD" value="master-foobar"/>
    </test>

<!-- if (master/slave) -->

    <test type="selenium">
        <precondition var="master-slave" eq="1"/>

        <name>EnableUsersEboxMaster</name>
        <desc>
        Enable users module on ebox-master.
        </desc>

        <host>ebox-master</host>
        <dir>enable-users</dir>
    </test>

    <test type="selenium">
        <precondition var="master-slave" eq="1"/>

        <name>SetSlave</name>
        <desc>
        Configure eBox as LDAP slave of ebox-master and set the password.
        </desc>

        <host>ebox-test</host>
        <dir>set-slave</dir>
        <var name="IP" value="192.168.2.169"/>
        <var name="PASSWORD" value="ebox-foobar"/>
    </test>

<!-- end if -->

    <test type="selenium">
        <name>EnableUsersEboxTest</name>
        <desc>
        Enable users module on ebox-test.
        </desc>

        <host>ebox-test</host>
        <dir>enable-users</dir>
    </test>

    <test type="selenium">
        <name>AddUser</name>
        <desc>Adds an user through the ebox web interface
        and checks if addedd correctly in LDAP database
        </desc>

        <host var="master-slave" eq="1">ebox-master</host>
        <host var="master-slave" eq="0">ebox-test</host>

        <dir>add-user</dir>
        <var name="USERNAME" value="eboxtest"/>
        <var name="PASSWORD" value="eboxtest"/>
    </test>

    <test>
        <name>CheckUser</name>
        <desc>Checks if the user is added correctly on LDAP</desc>

        <host>ebox-test</host>
        <dir>test-checkuser</dir>
        <var name="USERNAME" value="eboxtest"/>
        <var name="PASSWORD" value="ebox-foobar"/>
    </test>

    <test type="selenium">
        <name>AddGroup</name>
        <desc>Adds a group through the ebox web interface.
        And then adds the user created before to the group.
        </desc>

        <host var="master-slave" eq="1">ebox-master</host>
        <host var="master-slave" eq="0">ebox-test</host>

        <dir>test-addgroup</dir>
        <var name="USERNAME" value="eboxtest"/>
        <var name="GROUP" value="foobar"/>
    </test>

    <test>
        <name>CheckGroup</name>
        <desc>Checks if the user is added to the group</desc>

        <host>ebox-test</host>
        <dir>test-checkgroup</dir>
        <var name="USERNAME" value="eboxtest"/>
        <var name="GROUP" value="foobar"/>
        <var name="PASSWORD" value="ebox-foobar"/>
    </test>

    <test>
        <precondition var="master-slave" eq="1"/>

        <name>StopApache</name>
        <desc>
        Stop ebox apache on the slave.
        </desc>

        <host>ebox-test</host>
        <dir>apache-updown</dir>
        <var name="ACTION" value="stop"/>
    </test>

    <test type="selenium">
        <precondition var="master-slave" eq="1"/>

        <name>AddUserWithSlaveDown</name>
        <desc>Adds an user through the ebox web interface
        and checks if addedd correctly in LDAP database
        </desc>

        <host var="master-slave" eq="1">ebox-master</host>
        <host var="master-slave" eq="0">ebox-test</host>

        <dir>add-user</dir>
        <var name="USERNAME" value="slavedownuser"/>
        <var name="PASSWORD" value="slavedownuser"/>
    </test>

<!-- TODO: check slave status resync pending -->

    <test>
        <precondition var="master-slave" eq="1"/>

        <name>StartApache</name>
        <desc>
        Start ebox apache on the slave.
        </desc>

        <host>ebox-test</host>
        <dir>apache-updown</dir>
        <var name="ACTION" value="start"/>
    </test>

<!-- TODO: force resync test -->

    <test>
        <precondition var="master-slave" eq="1"/>

        <name>CheckUserWithSlaveDown</name>
        <desc>Checks if the user is added correctly on LDAP</desc>

        <host>ebox-test</host>
        <dir>test-checkuser</dir>
        <var name="USERNAME" value="slavedownuser"/>
        <var name="PASSWORD" value="ebox-foobar"/>
    </test>
</suite>
