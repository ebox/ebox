#!/usr/bin/perl

use strict;
use warnings;

use EBox;
use EBox::Global;

EBox::init();
my $global = EBox::Global->getInstance(1);
my $software = $global->modInstance('software');
$software->updatePkgList();
$software->fetchAllPkgs();

#call listUpgradablePkgs even if we're not using them just now as this
#causes the cache to be generated
my @pkgs = @{$software->listUpgradablePkgs(1)};
#call also listEBoxPkgs to regen the cache
my @eboxpkgs = @{$software->listEBoxPkgs(1)};

unless ($software->getAutomaticUpdates()) {
	exit 0;
}

my @pkgnames = ();
foreach my $pkg (@pkgs) {
	push(@pkgnames, $pkg->{name});
}
$software->installPkgs(@pkgnames);
